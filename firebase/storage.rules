rules_version = '2';
service firebase.storage {
  match /{allPaths=**} {
    // Denegar todo por defecto, solo permitir reglas específicas
    allow read, write: if false;
  }

  // Solo usuarios autenticados pueden acceder a sus archivos
  match /users/{userId}/{allPaths=**} {
    allow read, write: if request.auth != null && request.auth.uid == userId;
  }

  // Reglas específicas para attachments con validación
  match /users/{userId}/notes/{noteId}/{fileId} {
    allow read, write: if request.auth != null && 
      request.auth.uid == userId &&
      request.resource.size <= 10 * 1024 * 1024;
  }
}